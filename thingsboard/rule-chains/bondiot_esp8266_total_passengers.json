{
  "ruleChain": {
    "additionalInfo": {
      "description": ""
    },
    "name": "BondIoT-ESP8266-Total_Passengers",
    "type": "CORE",
    "firstRuleNodeId": null,
    "root": false,
    "debugMode": false,
    "configuration": null
  },
  "metadata": {
    "firstNodeIndex": null,
    "nodes": [
      {
        "additionalInfo": {
          "description": "",
          "layoutX": 518,
          "layoutY": 152
        },
        "type": "org.thingsboard.rule.engine.metadata.TbGetAttributesNode",
        "name": "Add metadata",
        "debugMode": true,
        "configuration": {
          "tellFailureIfAbsent": true,
          "clientAttributeNames": [],
          "sharedAttributeNames": [],
          "serverAttributeNames": [
            "passengersMAC",
            "passengersDoors",
            "passengersLoadcell"
          ],
          "latestTsKeyNames": [],
          "getLatestValueWithTs": false
        }
      },
      {
        "additionalInfo": {
          "description": "",
          "layoutX": 549,
          "layoutY": 398
        },
        "type": "org.thingsboard.rule.engine.filter.TbJsFilterNode",
        "name": "Check if Passengers by MAC is ok",
        "debugMode": true,
        "configuration": {
          "jsScript": "var passengerByMAC =  metadata.ss_passengersMAC\n\nif (passengerByMAC < 0) return false;\nif(passengerByMAC > 100) return false\nreturn true;\n"
        }
      },
      {
        "additionalInfo": {
          "description": "",
          "layoutX": 548,
          "layoutY": 497
        },
        "type": "org.thingsboard.rule.engine.filter.TbJsFilterNode",
        "name": "Check if Passengers by MAC is ok",
        "debugMode": true,
        "configuration": {
          "jsScript": "var passengerByMAC =  metadata.ss_passengersMAC\n\nif (passengerByMAC < 0) return false;\nif(passengerByMAC > 100) return false\nreturn true;\n"
        }
      },
      {
        "additionalInfo": {
          "description": "",
          "layoutX": 555,
          "layoutY": 635
        },
        "type": "org.thingsboard.rule.engine.filter.TbJsFilterNode",
        "name": "Check if Passengers by MAC is ok",
        "debugMode": true,
        "configuration": {
          "jsScript": "var passengerByMAC =  metadata.ss_passengersMAC\n\nif (passengerByMAC < 0) return false;\nif(passengerByMAC > 100) return false\nreturn true;\n"
        }
      },
      {
        "additionalInfo": {
          "description": "",
          "layoutX": 797,
          "layoutY": 206
        },
        "type": "org.thingsboard.rule.engine.transform.TbTransformMsgNode",
        "name": "Average number of passengers",
        "debugMode": true,
        "configuration": {
          "jsScript": "var newMsgType = \"POST_ATTRIBUTES_REQUEST\";\nvar passengersAverage = (parseInt(metadata.ss_passengersLoadcell) + parseInt(metadata.ss_passengersMAC) + parseInt(metadata.ss_passengersDoors))/3;\nvar newMsg = {};\n\nnewMsg.passengersTOTAL = Math.round(passengersAverage);\nreturn {msg: newMsg, metadata: metadata, msgType: newMsgType};"
        }
      },
      {
        "additionalInfo": {
          "description": "",
          "layoutX": 1200,
          "layoutY": 411
        },
        "type": "org.thingsboard.rule.engine.telemetry.TbMsgAttributesNode",
        "name": "Save Attributes",
        "debugMode": false,
        "configuration": {
          "scope": "SERVER_SCOPE",
          "notifyDevice": false
        }
      },
      {
        "additionalInfo": {
          "description": "",
          "layoutX": 320,
          "layoutY": 324
        },
        "type": "org.thingsboard.rule.engine.filter.TbJsFilterNode",
        "name": "Check if Passengers by doors is ok",
        "debugMode": true,
        "configuration": {
          "jsScript": "var passengerBySensor =  metadata.ss_passengersDoors\nif (passengerBySensor < 0) return false;\nif(passengerBySensor > 100) return false;\nreturn true;"
        }
      },
      {
        "additionalInfo": {
          "description": "",
          "layoutX": 539,
          "layoutY": 251
        },
        "type": "org.thingsboard.rule.engine.filter.TbJsFilterNode",
        "name": "Check if Passengers by MAC is ok",
        "debugMode": true,
        "configuration": {
          "jsScript": "var passengerByMAC =  metadata.ss_passengersMAC\n\nif (passengerByMAC < 0) return false;\nif(passengerByMAC > 100) return false\nreturn true;\n"
        }
      },
      {
        "additionalInfo": {
          "description": "",
          "layoutX": 782,
          "layoutY": 334
        },
        "type": "org.thingsboard.rule.engine.transform.TbTransformMsgNode",
        "name": "Average number of passengers without MAC",
        "debugMode": true,
        "configuration": {
          "jsScript": "var newMsgType = \"POST_ATTRIBUTES_REQUEST\";\nvar passengersAverage = (parseInt(metadata.ss_passengersLoadcell) + parseInt(metadata.ss_passengersDoors))/2;\nvar newMsg = {};\n\nnewMsg.passengersAvg = Math.round(passengersAverage);\nreturn {msg: newMsg, metadata: metadata, msgType: newMsgType};"
        }
      },
      {
        "additionalInfo": {
          "description": "",
          "layoutX": 803,
          "layoutY": 499
        },
        "type": "org.thingsboard.rule.engine.transform.TbTransformMsgNode",
        "name": "Average number of passengers without Weight",
        "debugMode": true,
        "configuration": {
          "jsScript": "var newMsgType = \"POST_ATTRIBUTES_REQUEST\";\nvar passengersAverage =  (parseInt(metadata.ss_passengersMAC) + parseInt(metadata.ss_passengersDoor))/2;\nvar newMsg = {};\n\nnewMsg.passengersAvg = Math.round(passengersAverage);\nreturn {msg: newMsg, metadata: metadata, msgType: newMsgType};"
        }
      },
      {
        "additionalInfo": {
          "description": "",
          "layoutX": 806,
          "layoutY": 581
        },
        "type": "org.thingsboard.rule.engine.transform.TbTransformMsgNode",
        "name": "Average number of passengers without Weight and MAC",
        "debugMode": true,
        "configuration": {
          "jsScript": "var newMsgType = \"POST_ATTRIBUTES_REQUEST\";\nvar passengersAverage = ( parseInt(metadata.ss_passengersDoors));\nvar newMsg = {};\n\nnewMsg.passengersAvg = Math.round(passengersAverage);\nreturn {msg: newMsg, metadata: metadata, msgType: newMsgType};"
        }
      },
      {
        "additionalInfo": {
          "description": "",
          "layoutX": 782,
          "layoutY": 389
        },
        "type": "org.thingsboard.rule.engine.transform.TbTransformMsgNode",
        "name": "Average number of passengers without Sensor",
        "debugMode": true,
        "configuration": {
          "jsScript": "var newMsgType = \"POST_ATTRIBUTES_REQUEST\";\nvar passengersAverage = (parseInt(metadata.ss_passengersWeight) + parseInt(metadata.ss_passengersMAC) )/2;\nvar newMsg = {};\nnewMsg.passengersAvg = Math.round(passengersAverage);\nreturn {msg: newMsg, metadata: metadata, msgType: newMsgType};"
        }
      },
      {
        "additionalInfo": {
          "description": "",
          "layoutX": 787,
          "layoutY": 441
        },
        "type": "org.thingsboard.rule.engine.transform.TbTransformMsgNode",
        "name": "Average number of passengers without MAC and Sensor",
        "debugMode": true,
        "configuration": {
          "jsScript": "var newMsgType = \"POST_ATTRIBUTES_REQUEST\";\nvar passengersAverage = (parseInt(metadata.ss_passengersWeight));\nvar newMsg = {};\n\nnewMsg.passengersAvg = Math.round(passengersAverage);\nreturn {msg: newMsg, metadata: metadata, msgType: newMsgType};"
        }
      },
      {
        "additionalInfo": {
          "description": "",
          "layoutX": 818,
          "layoutY": 658
        },
        "type": "org.thingsboard.rule.engine.transform.TbTransformMsgNode",
        "name": "Average number of passengers without Weight and Sensor",
        "debugMode": true,
        "configuration": {
          "jsScript": "var newMsgType = \"POST_ATTRIBUTES_REQUEST\";\nvar passengersAverage = ( parseInt(metadata.ss_passengersMAC));\nvar newMsg = {};\n\nnewMsg.passengersAvg = Math.round(passengersAverage);\nreturn {msg: newMsg, metadata: metadata, msgType: newMsgType};"
        }
      },
      {
        "additionalInfo": {
          "description": "",
          "layoutX": 825,
          "layoutY": 741
        },
        "type": "org.thingsboard.rule.engine.transform.TbTransformMsgNode",
        "name": "Average number of passengers No data",
        "debugMode": true,
        "configuration": {
          "jsScript": "var newMsgType = \"POST_ATTRIBUTES_REQUEST\";\nvar passengersAverage = 0;\nvar newMsg = {};\n\nnewMsg.passengersAvg = Math.round(passengersAverage);\nreturn {msg: newMsg, metadata: metadata, msgType: newMsgType};"
        }
      },
      {
        "additionalInfo": {
          "description": "",
          "layoutX": 47,
          "layoutY": 374
        },
        "type": "org.thingsboard.rule.engine.filter.TbJsFilterNode",
        "name": "Check if passengersLoadcell is ok",
        "debugMode": true,
        "configuration": {
          "jsScript": "var passengerByWeight =  metadata.ss_passengersLoadcell;\n\nif (passengerByWeight < 0) return false;\n\nif(passengerByWeight > 100) return false;\n\nreturn true;"
        }
      },
      {
        "additionalInfo": {
          "description": "",
          "layoutX": 240,
          "layoutY": 151
        },
        "type": "org.thingsboard.rule.engine.debug.TbMsgGeneratorNode",
        "name": "Generator",
        "debugMode": true,
        "configuration": {
          "msgCount": 0,
          "periodInSeconds": 5,
          "jsScript": "var msg = {};\nvar metadata = { readingMode: \"Reading\",MACAddress:\"C0:9A:D0:AF:50:CD\" };\nvar msgType = \"POST_TELEMETRY_REQUEST\";\n\nreturn { msg: msg, metadata: metadata, msgType: msgType };",
          "originatorId": null,
          "originatorType": null
        }
      },
      {
        "additionalInfo": {
          "description": "",
          "layoutX": 310,
          "layoutY": 488
        },
        "type": "org.thingsboard.rule.engine.filter.TbJsFilterNode",
        "name": "Check if Passengers by doors is ok",
        "debugMode": true,
        "configuration": {
          "jsScript": "var passengerBySensor =  metadata.ss_passengersDoors\nif (passengerBySensor < 0) return false;\nif(passengerBySensor > 100) return false;\nreturn true;"
        }
      }
    ],
    "connections": [
      {
        "fromIndex": 0,
        "toIndex": 15,
        "type": "Success"
      },
      {
        "fromIndex": 1,
        "toIndex": 12,
        "type": "False"
      },
      {
        "fromIndex": 1,
        "toIndex": 11,
        "type": "True"
      },
      {
        "fromIndex": 2,
        "toIndex": 10,
        "type": "False"
      },
      {
        "fromIndex": 2,
        "toIndex": 9,
        "type": "True"
      },
      {
        "fromIndex": 3,
        "toIndex": 14,
        "type": "False"
      },
      {
        "fromIndex": 3,
        "toIndex": 13,
        "type": "True"
      },
      {
        "fromIndex": 4,
        "toIndex": 5,
        "type": "Success"
      },
      {
        "fromIndex": 6,
        "toIndex": 1,
        "type": "False"
      },
      {
        "fromIndex": 6,
        "toIndex": 7,
        "type": "True"
      },
      {
        "fromIndex": 7,
        "toIndex": 8,
        "type": "False"
      },
      {
        "fromIndex": 7,
        "toIndex": 4,
        "type": "True"
      },
      {
        "fromIndex": 8,
        "toIndex": 5,
        "type": "Success"
      },
      {
        "fromIndex": 9,
        "toIndex": 5,
        "type": "Success"
      },
      {
        "fromIndex": 10,
        "toIndex": 5,
        "type": "Success"
      },
      {
        "fromIndex": 11,
        "toIndex": 5,
        "type": "Success"
      },
      {
        "fromIndex": 12,
        "toIndex": 5,
        "type": "Success"
      },
      {
        "fromIndex": 13,
        "toIndex": 5,
        "type": "Success"
      },
      {
        "fromIndex": 14,
        "toIndex": 5,
        "type": "Success"
      },
      {
        "fromIndex": 15,
        "toIndex": 17,
        "type": "False"
      },
      {
        "fromIndex": 15,
        "toIndex": 6,
        "type": "True"
      },
      {
        "fromIndex": 16,
        "toIndex": 0,
        "type": "Success"
      },
      {
        "fromIndex": 17,
        "toIndex": 3,
        "type": "False"
      },
      {
        "fromIndex": 17,
        "toIndex": 2,
        "type": "True"
      }
    ],
    "ruleChainConnections": null
  }
}